{% extends 'base.html' %}

{% load static %}

{% block content %}

<style>

    #continue-shopping{
        font-size: 20px;
        color:rgb(228, 174, 12);
        text-decoration: none;
    }

    td{
        vertical-align: middle;
    }
        
    #remove-link{
        font-size: 13px;
        display:block;
        position:absolute;
        text-decoration: none;
        color:black;
        opacity: 0.4;
        padding-top: 6px;
        padding-left: 1.2%;
    }

    #remove-link:hover{
        opacity: 0.8;
    }

    #checkout{
        background-color: rgb(248, 187, 5);
        width: 90%;
        border-radius: 7px;
        color: #F1FAEE;
        cursor: pointer;
        font-size: 1.3em;
    }


    .qty-input{
        width:45px;
        text-align: right;
    }

    @media (max-width: 768px) {
        table, .total-price{
            font-size: 14px;
        }
        #checkout{
            border-radius: 5px;
            font-size: 16px;
        }
    }

</style>

<div class="container-fluid col-sm-11 col-lg-8 my-3">
    <a href="{% url 'coffees:all_coffees' %}" id="continue-shopping" class="mt-3">&#8592; Continue shopping</a>
    
    {% if cart %}

    <h2 class="fw-light py-4 text-center">Cart</h2>

    <table class="table mb-4">
        <thead>
            <th></th>
            <th>Product</th>
            <th class="text-center">Price</th>
            <th class="text-center">Quantity</th>
            <th class="text-center">Total</th>
        </thead>

    <tbody>
    {% for item in cart %}
        {% with product=item.product %}
        <tr>
            <td width="14%">
                <a href="{% url 'coffees:coffee_detail' pk=product.id %}">
                    <img src="{{ product.image.url }}" width="100px" height="100px">
                </a>
            </td>
            <td>{{ product.name }}</td>

            {% if product.out_of_stock %}
            <td></td>
            <td class="text-center px-0" width="10%">
                <p class="fw-light mb-0">Out of stock</p>
                <a id='remove-link' href="{% url 'cart:cart_remove' product.id %}" style="padding-left: 1.8% !important;">Remove</a>
            </td>
            <td></td>

            {% else %}
            <div class="content-not-product">
            <td class="text-center" width="10%">${{ item.price|floatformat:2 }}</td>
            <td class="text-center" width="10%">
                <form action="{% url 'cart:cart_update' product_id=product.id %}" method="post" class="qty-input-form" name="product-{{product.id}}">
                    {% csrf_token %}
                    <input type="number" data-product="product-{{product.id}}" name="quantity" min="1" max="{{product.amount}}" value="{{item.quantity}}" class="qty-input">
                </form>
                <a id='remove-link' href="{% url 'cart:cart_remove' product.id %}">Remove</a>
            </td>
            <td class="text-center" width="10%">${{ item.total_price|floatformat:2 }}</td>
            </div>
            {% endif %}
        </tr>
        {% endwith %}
    {% endfor %}
    </tbody>
    </table>
    <div class="row mb-4">
        <div class="col" style="text-align:right;">
            <h4 class="mt-2 total-price">Total: ${{cart.get_total_price|floatformat:2}}</h4>
        </div>
        <div class="col-3">
            <a href="{% url 'shop:checkout' %}" class="btn" id="checkout">Checkout</a>
        </div>
    </div>

    {% else %}
    <h3 class="fw-light my-5 mx-3">There is nothing in your cart yet.</h3>
    {% endif %}

</div>

{% block js %}
    <script>
        jQuery(document).ready(function(){
            $(".qty-input").blur(function(){
                var product = this.dataset.product;
                $("form[name="+product+"]").submit()
            });
        });

    </script>
{% endblock %}

{% endblock %}
